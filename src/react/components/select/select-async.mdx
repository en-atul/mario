import { Meta, Title, Primary, Stories, Controls } from "@storybook/addon-docs/blocks";
import SelectAsyncStories from "./select-async.stories";

<Title>SelectAsync</Title>

<Meta of={SelectAsyncStories} />

SelectAsync is an asynchronous select component with infinite scroll capabilities. It loads data in chunks as users scroll, making it ideal for large datasets or remote data sources.

<Primary />

<Controls />

## Features

- **Infinite scroll**: Automatically loads more data as user scrolls using Intersection Observer
- **Async data loading**: Loads options from async functions (API calls, filtered data, etc.)
- **Search/Filter**: Debounced search with customizable delay (300ms default)
- **Single & Multi select**: Supports both single and multiple selection modes
- **Loading states**: Visual feedback during data loading
- **Pagination**: Built-in pagination support

## Props

- **loadOptions** (required): Async function that returns `{ options, hasMore }`
  - Receives `(searchTerm: string, page: number)` as parameters
  - Returns `Promise<LoadOptionsResult>`
- **value**: Array of selected option values
- **onChange**: Callback when selection changes
- **isMulti**: Enable multiple selection (default: false)
- **placeholder**: Placeholder text
- **variant**: Visual variant (default, error)
- **size**: Size variant (sm, md, lg)

## LoadOptions Function

The `loadOptions` function should:
1. Accept `searchTerm` and `page` parameters
2. Return a Promise with `{ options: SelectOption[], hasMore: boolean }`
3. Handle pagination logic internally
4. Filter based on searchTerm if provided

## Infinite Scroll

The component uses Intersection Observer to detect when the user scrolls near the bottom. When the loading indicator becomes visible and more data is available, it automatically fetches the next page.

## Search Debouncing

Search is debounced by 300ms to avoid excessive API calls while typing. The component resets to page 1 when search term changes.

## Usage Example

```tsx
const loadOptions = async (searchTerm: string, page: number) => {
  const response = await fetch(`/api/options?q=${searchTerm}&page=${page}`);
  const data = await response.json();
  return {
    options: data.items,
    hasMore: data.hasMore,
  };
};

<SelectAsync
  loadOptions={loadOptions}
  value={selected}
  onChange={setSelected}
  isMulti
/>
```

<Stories />
